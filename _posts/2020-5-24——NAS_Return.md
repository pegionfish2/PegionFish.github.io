---
layout: post
author: Bob Guo
title: ç”¨Precisionåšè½¯è·¯ç”±æ˜¯ä»€ä¹ˆä½“éªŒï¼ˆ1ï¼‰
subtitle: æœ¬åœ°é…ç½®OpenWRTç¼–è¯‘ç¯å¢ƒ
date: 2020-5-24
tags: è½¯è·¯ç”± OpenWRT
published: true #write true to publish this article.
---
å…„å¼ŸèŒï¼ŒğŸ‘´å›æ¥äº†ã€‚  
ä¹‹å‰åœ¨[è¿™ç¯‡è¿˜æ²¡æœ‰å†™å®Œçš„æ–‡ç« ](2020-4-14-NAS_Ending.md)é‡Œæˆ‘å…¶å®å·²ç»ç»“æŸäº†å°è¯•ã€‚ç”±äºç½‘ä¸Šèƒ½æ‰¾åˆ°çš„æ•™ç¨‹èµ„æ–™å¯¹äºæˆ‘çš„ç¯å¢ƒæ¥è¯´å®ç”¨æ„ä¹‰ä¸å¤§ï¼Œè€Œæˆ‘æœ€åçš„åº•ç‰Œâ€”æœ¬åœ°ç¼–è¯‘ç”±äºG1840çš„ç¾¸å¼±æ€§èƒ½ä¹Ÿæ— æ³•å®ç°ã€‚ä¸è¿‡ï¼Œè¿˜è®°å¾—æˆ‘çš„[Precision T1700 SFF](2020-4-18-Precision_T1700_1.md)å·¥ä½œç«™å—ï¼Ÿå®ƒçš„å°ºå¯¸çœŸçš„æ˜¯å°å·§ç²ç‘ï¼Œé…åˆä½å‹XeonåšHeadlessæœåŠ¡å™¨ä½“éªŒä¼šå¾ˆæ£’ã€‚ç”±äºæˆ‘å¹¶ä¸éœ€è¦è¶…å¤§å®¹é‡çš„æœ¬åœ°å­˜å‚¨ç©ºé—´ï¼Œæˆ‘ä»ç„¶æ²¿ç”¨åŸæ¥è½¯è·¯ç”±ä¸Šçš„128Gå›ºæ€ç¡¬ç›˜ï¼›è€Œå†…å­˜ä¹Ÿæ”¹ä¸ºä¸¤æ¡4GB DDR3 1600å†…å­˜ç»„æˆ1DPCåŒé€šé“ï¼Œå‰©ä¸‹çš„16Gå†…å­˜å°±ç•™ä½œä»–ç”¨ã€‚å¦‚æœæœªæ¥å‡ºç°ç¼–è¯‘AOSPæˆ–æ¸²æŸ“è§†é¢‘ç­‰éœ€æ±‚è¿˜å¯ä»¥å†æ’ä¸Šå»ç»„æˆ24GBåŒé€šé“ã€‚æˆ‘çš„é‚£å¼ HD8570ä¹Ÿä»ç„¶æ”¾åœ¨é‚£é‡Œï¼Œè™½ç„¶å®ƒå­˜åœ¨é‚£é‡Œçš„å”¯ä¸€ç†ç”±å°±æ˜¯æˆ‘è¿˜æ²¡æœ‰å½»åº•é…ç½®å¥½Headlessè€Œæˆ‘ä½¿ç”¨çš„Xeonæ²¡æœ‰æ ¸å¿ƒæ˜¾å¡æ— æ³•æ­£å¸¸å·¥ä½œã€‚å¦‚æœæœªæ¥å­˜åœ¨å¯¹CUDAè®¡ç®—æœ‰è¦æ±‚çš„åœºæ™¯ï¼Œæˆ‘å¯èƒ½ä¼šä¹°ä¸€å¼ Quadroä¸¢è¿›å»ã€‚  
# 0x01 åº”ç”¨ç¯å¢ƒ
ç½‘å¡ä»ç„¶æ˜¯i340ï¼Œå››å£åƒå…†ï¼ŒIBMåŸè£…ï¼Œè€å½“ç›Šå£®çš„ç»å…¸ç½‘å¡ã€‚ä¹°äº†å°å°ºå¯¸æŒ¡æ¿ä¹‹åè·Ÿæˆ‘çš„æœºç®±å¾ˆé€‚é…ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥æ­£å¸¸è¯†åˆ«ã€‚æœ¬æ¥æˆ‘æ‰“ç®—è£…ä¸€å¼ æ— çº¿ç½‘å¡å¹¶é€šè¿‡SSHè¿æ¥ï¼Œä½†ç”±äºæš‚æ—¶æ— æ³•æˆåŠŸæˆ‘å°±å…ˆæŠŠå®ƒæ¢æˆæ˜¾å¡ï¼Œåœ¨GUIç¯å¢ƒä¸‹å·¥ä½œã€‚è¿™å¼ ç½‘å¡çš„å››ä¸ªæ¥å£å…¨éƒ¨ä¼šè¢«ç”¨ä½œè¿æ¥å¤–éƒ¨è®¾å¤‡ï¼Œè€Œè·¯ç”±æœ¬ä½“ä¸ç½‘é™…ç½‘è·¯çš„äº¤äº’å°†ä¼šç”±æœºå™¨æ¿è½½çš„åƒå…†ç½‘å¡è¿›è¡Œã€‚  
æ“ä½œç³»ç»Ÿä»ç„¶æ˜¯Ubuntu 20.04 LTSç‰ˆã€‚æˆ‘ä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²Archï¼Œè™½ç„¶AURç¡®å®å¾ˆå¥½ç”¨ï¼Œè€Œä¸”ä¸æƒ³ç”¨Archä¹Ÿå±äºæˆ‘ä¸ªäººçš„biasï¼Œä½†ç›®å‰æˆ‘è¿˜æ²¡æœ‰è¾¾åˆ°é‚£ä¸ªå¢ƒç•Œï¼ŒUbuntuä¹Ÿè¶³å¤Ÿå¥½ç”¨ã€‚è€Œä¸”ï¼Œå¤§éƒ¨åˆ†æ•™ç¨‹é¢„è®¾çš„ç¼–è¯‘ç¯å¢ƒéƒ½æ˜¯Ubuntuï¼Œä½¿ç”¨Arch Linuxå¯èƒ½å­˜åœ¨ä¸€äº›å°é—®é¢˜ï¼Œè€Œè¿™äº›é—®é¢˜éœ€è¦å¤šæ¬¡debugæ‰èƒ½è§£é™¤ã€‚è‡³äºè½¯è·¯ç”±éƒ¨åˆ†ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨è™šæ‹Ÿæœºé…åˆOpenWRTè¿›è¡Œã€‚OpenWRTæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºè·¯ç”±å™¨ç­‰åµŒå…¥å¼è®¾å¤‡å®šåˆ¶çš„Linuxå‘è¡Œç‰ˆï¼Œè€Œç›¸æ¯”äºå…¶ä»–åŸºäºLinuxçš„è·¯ç”±å™¨å›ºä»¶ï¼Œå®ƒæ›´åƒä¼ ç»Ÿçš„Linuxæ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥è‡ªç”±åœ°å®‰è£…ä¸åŒçš„è½¯ä»¶ã€‚è€Œä¸”ï¼Œå®ƒé™¤äº†å¸¸è§çš„MIPSæˆ–ARMæ¶æ„ä¹‹å¤–ï¼Œä¹Ÿæ”¯æŒx86æ¶æ„ï¼Œè¿™ä¹Ÿè®©å®ƒæˆä¸ºäº†è½¯è·¯ç”±çš„æœ€ä½³é€‰æ‹©ä¹‹ä¸€ã€‚ä¸ºæ­¤ï¼Œæˆ‘éœ€è¦åœ¨æœ¬åœ°ç¼–è¯‘OpenWRTã€‚
# 0x10 è®¾ç½®Proxychains
ç”±äºOpenWRTçš„æºä»£ç æ‰˜ç®¡åœ¨GitHubä¸Šï¼Œè€ŒGitHubåœ¨å›½å†…çš„ä½¿ç”¨ç¯å¢ƒæ˜¯äººå°½çš†çŸ¥çš„å·®ï¼Œæ‰€ä»¥è·å–æºç ä¹‹å‰è¦åšçš„æ˜¯éƒ¨ç½²[ProxChains](https://github.com/haad/proxychains)ã€‚åªè¦åœ¨å‘½ä»¤å‰è¾“å…¥proxychainså°±å¯ä»¥è®©è¿™æ¡å‘½ä»¤ä½¿ç”¨ä»£ç†è¿è¡Œè€Œä¸ç”¨è°ƒæ•´gitçš„ä»£ç†è®¾ç½®ï¼Œæ˜¯ä¸€ä¸ªæ›´ä¸ºçµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚Proxychainsåœ¨å¤§éƒ¨åˆ†å‘è¡Œç‰ˆçš„å®˜æ–¹ä»“åº“é‡Œéƒ½æœ‰ï¼Œåªè¦ç”¨ä½ çš„åŒ…ç®¡ç†å™¨å®‰è£…Proxychainså°±å¯ä»¥äº†ã€‚
> sudo apt-get install proxychains

å®‰è£…å®Œproxychainsï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ ¹æ®ä½ ä½¿ç”¨çš„ä»£ç†è°ƒæ•´*/etc/proxychains*å¹¶åœ¨æœ«å°¾åŠ å…¥ä½ ä½¿ç”¨çš„ä»£ç†åè®®ã€åœ°å€ä¸ç«¯å£ã€‚å¯¹äºå¤§éƒ¨åˆ†äººæ¥è®²ï¼Œåªè¦åŠ å…¥socks5 127.0.0.1 1080å³å¯ã€‚  
å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æœ¬åœ°ç¼–è¯‘ä¸€ä»½ï¼Œä½†è¿™ä¸€å—å°±åœ¨æ­¤ä¸è¡¨ã€‚
# 0x11 è·å–OpenWRTæºä»£ç 
OpenWRTçš„æºä»£ç æ‰˜ç®¡åœ¨[è¿™é‡Œ](https://github.com/openwrt/openwrt)ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨KoolShareè®ºå›çš„ç‰ˆæœ¬ï¼Œä½†æˆ‘ä¸ªäººè¿˜æ˜¯æ›´åå‘è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œè°ƒæ•™è½¯è·¯ç”±ä¹Ÿå¯ä»¥ä½œä¸ºè€ƒç ”å¤‡è€ƒçš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸”æˆ‘ä¸ªäººå¯¹Koolshareè®ºå›çš„é—­æºå›ºä»¶å¹¶ä¸ä¿¡ä»»ï¼Œå°±è‡ªå·±æœ¬åœ°ç¼–è¯‘å’¯ã€‚   
æ‰“å¼€ç»ˆç«¯ï¼Œå®šä½åˆ°ä½ æƒ³è¦çš„åœ°æ–¹ï¼ˆæ¯”å¦‚æˆ‘å°±æ”¾åœ¨æ¡Œé¢ï¼‰ï¼Œå¹¶è¾“å…¥
> proxychains git clone git@github.com:openwrt/openwrt.git

å¦‚æœæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½ çš„ç”µè„‘ä¼šè‡ªåŠ¨åœ¨è¿™ä¸ªåœ°æ–¹å»ºç«‹ä¸€ä¸ªopenwrtçš„æ–‡ä»¶å¤¹ï¼Œå¹¶å¼€å§‹åŒæ­¥OpenWRTçš„æºä»£ç ã€‚å…·ä½“çš„æ—¶é•¿è¦æŒ‰ç…§ä½ çš„ç½‘ç»œçŠ¶å†µè€Œå®šï¼Œä½†ç”±äºæ–‡ä»¶æ€»é‡æ¯”è¾ƒå¤§ï¼ˆæ¯•ç«Ÿè¿™æ€ä¹ˆè¯´ä¹Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„Linuxå‘è¡Œç‰ˆï¼‰ï¼Œæœ€å¥½åšå¥½ç­‰å¾…ä¸€æ®µæ—¶é—´çš„å‡†å¤‡ã€‚  
åœ¨ä¸‹è½½å®Œæˆåï¼Œcdåˆ°openwrtæ–‡ä»¶å¤¹ï¼Œå¹¶è¾“å…¥
> git checkout openwrt-19.07

è¿™æ ·ä½ å°±ä¼šåˆ‡æ¢åˆ°OpenWRT 19.07ç‰ˆçš„åˆ†æ”¯ï¼Œå¹¶å¯ä»¥ä»¥æ­¤ä¸ºåŸºç¡€å¼€å§‹å¹²æ´»ã€‚
# 0x100 å®‰è£…ä¾èµ–
OpenWRTç¼–è¯‘çš„æ—¶å€™ä¼šéœ€è¦ç”¨åˆ°ä¸€äº›ä¾èµ–åŒ…ï¼Œè¿™äº›åŒ…ä¸€èˆ¬éƒ½å¯ä»¥åœ¨ä½ å‘è¡Œç‰ˆçš„å®˜æ–¹ä»“åº“é‡Œæ‰¾åˆ°ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥
> sudo apt-get install gcc g++ build-essential asciidoc  binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch flex bison make autoconf texinfo unzip sharutils subversion ncurses-term zlib1g-dev ccache upx lib32gcc1 libc6-dev-i386 uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev libglib2.0-dev xmlto qemu-utils automake libtool  -y

è¿™ä¼šè‡ªåŠ¨å®‰è£…æ‰€æœ‰éœ€è¦çš„ä¾èµ–ã€‚
# 0x101 é…ç½®ç¼–è¯‘ç¯å¢ƒå¹¶è·å–è½¯ä»¶åŒ…æºä»£ç 
åœ¨ç¼–è¯‘OpenWRTçš„æ—¶å€™ï¼ŒLike all other large scale projectsï¼Œä½ éœ€è¦é…ç½®ä¸€ä¸ªç¼–è¯‘ç¯å¢ƒã€‚OpenWRTæœ‰ä¸€ä¸ªè„šæœ¬å¯ä»¥è·å–ç¼–è¯‘æ—¶éœ€è¦çš„è½¯ä»¶åŒ…çš„æºä»£ç ï¼Œå°†å®ƒä¸€èµ·ç¼–è¯‘åˆ°ä½ çš„OpenWRTé‡Œã€‚  
ä¸ºäº†ä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼Œä½ éœ€è¦è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š
>proxychains ./scripts/feeds update -a  
proxychains ./scripts/feeds install -a

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼Œä¹‹åå°±å¯ä»¥å¼€å§‹é…ç½®å¹¶ç¼–è¯‘OpenWRTäº†ã€‚
